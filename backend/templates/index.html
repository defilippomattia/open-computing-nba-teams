<!DOCTYPE html>
<html>
    <title>jQuery Ajax Form Submit with FormData Example - NiceSnippets.com</title>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script> 
    <head>
      <title>NBA Teams Dataset</title>
      <meta name="description" content="NBA teams dataset made at Open Computing course lab at University of Zagreb, 
                                        Faculty of Electrical Engineering and Computing (FER).">
      <meta name="keywords" content="NBA, teams, players, dataset, basketball">
      <meta name="author" content="Mattia de Filippo">

    </head>
<body>
    <h1>NBA Teams</h1>
    <p>This is a publicly available dataset made at Open Computing course lab at University of Zagreb, 
      Faculty of Electrical Engineering and Computing (FER). The dataset provides information about the teams and players in NBA.</p>
      <table class="tg">
        <thead>
          <tr>
            <th class="tg-0pky">Repository URI</th>
            <th class="tg-0pky">https://github.com/defilippomattia/open-computing-nba-teams</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="tg-0lax">Language</td>
            <td class="tg-0lax">English</td>
          </tr>
          <tr>
            <td class="tg-0lax">Keywords</td>
            <td class="tg-0lax">nba, basketball, sports</td>
          </tr>
          <tr>
            <td class="tg-0lax">Publication Date</td>
            <td class="tg-0lax">2022-10-29</td>
          </tr>
          <tr>
            <td class="tg-0lax">Formats</td>
            <td class="tg-0lax">JSON, CSV</td>
          </tr>
        </tbody>
        </table>
    <br>
    <br>
    <input type="submit" value="Show Full CSV dataset" id="csvDownload"/>
    <input type="submit" value="Show Full JSON dataset" id="jsonDownload"/>
    <br>
    <br>

    <p class="csvclass" id="csvid"></p>
    <p class="jsonclass" id="jsonid"></p>




    <form method="POST" enctype="multipart/form-data" id="my-form">
        <label for="search_field_dropdown">Choose search field:</label>
        <select name="search_field_dropdown" id="search_field_dropdown">
          <option value="all">All</option>
          <option value="team">Team Name</option>
          <option value="location">Team Location</option>
          <option value="conference">Conference</option>
          <option value="division">Division</option>
          <option value="arena">Arena Name</option>
        </select>
        <br><br>
        <input type="text" id="input_from_search" name="input_from_search"/><br/><br/>
        <input type="submit" value="Submit" id="btnSubmit"/>

    </form>
    <img src="https://raw.githubusercontent.com/defilippomattia/open-computing-nba-teams/4a16ba82370af391573e7888713581f8cea435a8/backend/templates/columns.jpg" alt="Girl in a jacket">

<br>
<br>
<style>
  img {
  width: 95%;
  height: auto;
}
  .tg  {border-collapse:collapse;border-spacing:0;}
.tg td{border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;
  overflow:hidden;padding:10px 5px;word-break:normal;}
.tg th{border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;
  font-weight:normal;overflow:hidden;padding:10px 5px;word-break:normal;}
.tg .tg-0pky{border-color:inherit;text-align:left;vertical-align:top}
.tg .tg-0lax{text-align:left;vertical-align:top}
  p.csvclass {
    white-space: pre-line 
  }

  p.filteredcsvclass {
    white-space: pre-line 
  }
    table.GeneratedTable {
      width: 100%;
      background-color: #ffffff;
      border-collapse: collapse;
      border-width: 2px;
      border-color: #ffcc00;
      border-style: solid;
      color: #000000;
    }
    
    table.GeneratedTable td, table.GeneratedTable th {
      border-width: 2px;
      border-color: #ffcc00;
      border-style: solid;
      padding: 3px;
    }
    
    table.GeneratedTable thead {
      background-color: #ffcc00;
    }
    </style>
    

     <!-- <div class="dataTable_wrapper">
      <table class='table table-striped table-bordered table-hover GeneratedTable' id='records_table'>
        <tr class ='odd gradeX'>
          <th>Team Name</th>
          <th>Location</th>
          <th>Confernce</th>
          <th>Division</th>
          <th>Year Founded</th>
          <th>Arena</th>
          <th>Arena Capacity</th>
          <th>Championships</th>
          <th>Final Appearences</th>
          <th>Player Number</th>
          <th>Player Name</th>
          <th>Player Position</th>
        </tr>
      </table>
    </div>   -->

    <div class="dataTable_wrapper">
      <table class='table table-striped table-bordered table-hover GeneratedTable' id='records_table'>
        <tr class ='odd gradeX'>
          <th>Team Name</th>
          <th>Location</th>
          <th>Confernce</th>
          <th>Division</th>
          <th>Year Founded</th>
          <th>Arena</th>
          <th>Arena Capacity</th>
          <th>Championships</th>
          <th>Final Appearences</th>
          <th>Player Number</th>
          <th>Player Name</th>
          <th>Player Position</th>
        </tr>
      </table>
    </div>   


    <p class="filteredcsvclass" id="filteredcsvid"></p>
    <p class="filteredjsonclass" id="filteredjsonid"></p>
    <input type="submit" value="Show Filtered CSV" id="filteredCsvDownload"/>
    <input type="submit" value="Show Filtered JSON" id="filteredJsonDownload"/>


    <script type="text/javascript">
    	$(document).ready(function () {
            $("#btnSubmit").click(function (event) {
                event.preventDefault();
                var form = $('#my-form')[0];
                var data = new FormData(form);
                console.log(data)
                var trHTML = '';
                //var trHTML = '';
                $("#btnSubmit").prop("disabled", true);
                $.ajax({
                    type: "POST",
                    enctype: 'multipart/form-data',
                    url: "{{ url_for('create_file') }}",
                    data: data,
                    processData: false,
                    contentType: false,
                    cache: false,
                    timeout: 800000,
                    success: function (data) {
                        console.log("SUCCESS : ", data);
                      $.each(data, function (i, o){
                        trHTML += '<tr><td>' + o.players_name +
                                  '</td><td>' + o.players_position +
                                  '</td><td>' + o.players_number +
                                  '</td><td>' + o.team +
                                  '</td><td>' + o.arena +
                                  '</td><td>' + o.arena_capacity +
                                  '</td><td>' + o.championships +
                                  '</td><td>' + o.conference +
                                  '</td><td>' + o.division +
                                  '</td><td>' + o.finals_appearances +
                                  '</td><td>' + o.location +
                                  '</td><td>' + o.year_founded +
                                  '</td></tr>';
                      });
                      //$('#tbody#emp').append(trHTML);
                      $('#records_table').html(trHTML);
                      $("#btnSubmit").prop("disabled", false);
                    },
                    error: function (e) {
                        $("#output").text(e.responseText);
                        console.log("ERROR : ", e);
                        $("#btnSubmit").prop("disabled", false);
                    }
                });
            });
            $("#csvDownload").click(function (event) {
              console.log("Download CSV")
              var smt;
              $.ajax({
                type: "GET",
                    enctype: 'multipart/form-data',
                    url: "{{ url_for('full_csv_download') }}",
                    processData: false,
                    contentType: false,
                    cache: false,
                    timeout: 800000,
                    success: function (smt) {
                      console.log(smt)
                      $("#csvid").text(smt);

                    }
              })
            }) 
            $("#jsonDownload").click(function (event) {
              console.log("Download JSON")
              var smt
              $.ajax({
                type: "GET",
                    enctype: 'multipart/form-data',
                    url: "{{ url_for('full_json_download') }}",
                    processData: false,
                    contentType: false,
                    cache: false,
                    timeout: 800000,
                    success: function (smt) {
                      console.log(smt)
                      $("#csvid").text(smt);
                    }
              })
              // link = document.createElement('a')
              // link.setAttribute('href',encodeURI(smt))
              // link.setAttribute('download','full.json')
              // link.click()
            }) 
            
            $("#filteredJsonDownload").click(function (event){
              console.log("ludlo")
              event.preventDefault();
              var form = $('#my-form')[0];
              var data = new FormData(form);
              console.log(data)
              var trHTML = '';
              $("#filteredJsonDownload").prop("disabled", true);
              $.ajax({
                type: "POST",
                enctype: 'multipart/form-data',
                url: "{{ url_for('filtered_json_download') }}",
                data: data,
                processData: false,
                contentType: false,
                cache: false,
                timeout: 800000,
                success: function (data) {
                  console.log(data)
                  $("#filteredJsonDownload").prop("disabled", false);
                  $("#filteredjsonid").text(JSON.stringify(data,null,4));
                }

              })
            })
            $("#filteredCsvDownload").click(function (event){
              console.log("ludlo")
              event.preventDefault();
              var form = $('#my-form')[0];
              var data = new FormData(form);
              console.log(data)
              var trHTML = '';
              $("#filteredCsvDownload").prop("disabled", true);
              $.ajax({
                type: "POST",
                enctype: 'multipart/form-data',
                url: "{{ url_for('filtered_csv_download') }}",
                data: data,
                processData: false,
                contentType: false,
                cache: false,
                timeout: 800000,
                success: function (data) {
                  console.log(data)
                  $("#filteredCsvDownload").prop("disabled", false);
                  //$("#filteredcsvid").text(JSON.stringify(data,null,4));
                  $("#filteredcsvid").text(data);
                }

              })
            })
          });
        
    </script>
</body>
</html>